import streamlit as st
import yfinance as yf
import pandas as pd

st.set_page_config(page_title="Vijay Stock Guru тАУ India Edition", page_icon="ЁЯТ╣")

st.title("ЁЯЗоЁЯЗ│ Vijay Stock Guru тАУ India Edition")
st.caption("Powered by Chat Bhaiya ЁЯФ╣ Learning & Analysis Tool")

st.markdown("ЁЯУИ рдпрд╣ рдРрдк рднрд╛рд░рддреАрдп NSE рд╕реНрдЯреЙрдХреНрд╕ рдХрд╛ рд╡рд┐рд╢реНрд▓реЗрд╖рдг рдХрд░рддрд╛ рд╣реИ рдФрд░ Intrinsic Value, Margin of Safety, рддрдерд╛ Strength Score рджрд┐рдЦрд╛рддрд╛ рд╣реИред")

# --- Input Section ---
symbol = st.text_input("Enter NSE Stock Symbol (e.g., TCS.NS, RELIANCE.NS, INFY.NS):")

if st.button("ЁЯФН Fetch Data"):
    try:
        data = yf.Ticker(symbol)
        info = data.info

        eps = info.get("trailingEps", None)
        market_price = info.get("currentPrice", None)
        pe_ratio = info.get("trailingPE", None)
        roe = info.get("returnOnEquity", 0)
        roce = info.get("returnOnAssets", 0)
        debt_equity = info.get("debtToEquity", 0)

        if eps and market_price and pe_ratio:
            st.success("тЬЕ Data fetched successfully!")

            eps = st.number_input("EPS (Earnings Per Share)", value=float(eps))
            growth = st.number_input("Annual Growth Rate (%)", value=10.0)
            pe_ratio = st.number_input("P/E Ratio", value=float(pe_ratio))
            market_price = st.number_input("Market Price (тВ╣)", value=float(market_price))
            roe = st.number_input("ROE (%)", value=float(roe * 100 if roe else 0))
            roce = st.number_input("ROCE (%)", value=float(roce * 100 if roce else 0))
            debt_equity = st.number_input("Debt-to-Equity", value=float(debt_equity))

            if st.button("ЁЯУК Analyze Stock"):
                intrinsic_value = eps * (8.5 + (2 * growth))
                margin_of_safety = ((intrinsic_value - market_price) / market_price) * 100

                score = 0
                if margin_of_safety > 25: score += 2
                elif margin_of_safety > 10: score += 1
                if roe > 15: score += 1
                if roce > 15: score += 1
                if debt_equity < 1: score += 1

                verdict = "ЁЯТ╣ Strong Stock" if score >= 4 else "тЪЦя╕П Moderate Stock" if score >= 2 else "тЭМ Weak Stock"

                st.subheader("ЁЯУК Stock Analysis Result")
                st.write(f"**Intrinsic Value:** тВ╣{intrinsic_value:.2f}")
                st.write(f"**Margin of Safety:** {margin_of_safety:.2f}%")
                st.write(f"**Strength Score:** {score}/5")
                st.success(verdict)
        else:
            st.warning("тЭМ Data not available for this symbol. Try another NSE stock.")

    except Exception as e:
        st.error(f"тЪая╕П Error fetching data: {e}")

# --- Info Section ---
with st.expander("ЁЯУШ Learn Basic Terms"):
    st.markdown("""
    - **EPS (Earnings Per Share):** рдХрдВрдкрдиреА рдкреНрд░рддрд┐ рд╢реЗрдпрд░ рдХрд┐рддрдирд╛ рдореБрдирд╛рдлрд╛ рдХрдорд╛ рд░рд╣реА рд╣реИ  
    - **P/E Ratio:** рд╢реЗрдпрд░ рдХреА рдХреАрдордд рдмрдирд╛рдо рдореБрдирд╛рдлрд╛ тАФ рдХрдо рд╣реЛ рддреЛ рдмреЗрд╣рддрд░  
    - **ROE:** рдХрдВрдкрдиреА рдЕрдкрдиреЗ рд╢реЗрдпрд░рдзрд╛рд░рдХреЛрдВ рдХреА рдкреВрдВрдЬреА рд╕реЗ рдХрд┐рддрдирд╛ рд░рд┐рдЯрд░реНрди рджреЗ рд░рд╣реА рд╣реИ  
    - **ROCE:** рдХрдВрдкрдиреА рдЕрдкрдиреЗ рдХреБрд▓ рдкреВрдВрдЬреА рдкрд░ рдХрд┐рддрдирд╛ рд░рд┐рдЯрд░реНрди рдХрдорд╛ рд░рд╣реА рд╣реИ  
    - **Debt-to-Equity:** 1 рд╕реЗ рдХрдо рд╣реЛ рддреЛ рдЕрдЪреНрдЫрд╛  
    - **Margin of Safety:** Intrinsic Value рдЕрдЧрд░ рдЬрд╝реНрдпрд╛рджрд╛ рд╣реЛ рддреЛ рдЦрд░реАрджрдиреЗ рдХрд╛ рдореМрдХрд╛  
    """)
